<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
<title>Energy Consumption</title>
  
<style>
  body { font-family: Arial, Helvetica, sans-serif; padding: 18px; background:#f7f7f7; color:#111; }
  h1 { margin:0 0 10px 0; font-size:20px; }
  .sheet { background: white; padding:14px; border-radius:6px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); max-width:1100px; }
  table { border-collapse: collapse; width:100%; margin-bottom:18px; }
  th, td { border:1px solid #cfcfcf; padding:8px 10px; font-size:14px; vertical-align:middle; }
  th { background:#e6f0ff; text-align:left; font-weight:700; }
  td.num { text-align:right; font-family: "Courier New", monospace; }
/* Base style for all section titles */
.section-title {
  background: #e8f0ff;
  color: #0c2a66;
  font-weight: 700;
  font-size: 15px;
  padding: 10px;
  margin: 18px 0 8px 0;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Darker colors for main utility headers only */
.section-title.gas-main {
  background: #bcd4fa;          /* blue tone */
  color: #08244c;
  border: 1px solid #94b5f5;
}

.section-title.electricity {
  background: #fae3bc;          /* orange tone */
  color: #5b3c00;
  border: 1px solid #f0c97a;
}

.section-title.water {
  background: #c9f3dc;          /* green tone */
  color: #004d1a;
  border: 1px solid #97e0b6;
}
  .muted { color:#666; font-size:13px; }
  .warning { background:#fff3f0; color:#8a1f00; padding:6px 8px; border-radius:4px; display:inline-block; font-weight:700; }
  .red { color:#b30000; font-weight:700; }
  .small { font-size:13px; color:#333; }
  .meta { display:flex; gap:12px; margin-bottom:10px; align-items:center; }
  .meta .pill { background:#eef3ff; padding:6px 8px; border-radius:6px; font-size:13px; }
  .footnote { font-size:12px; color:#555; margin-top:8px; }
  @media (max-width:700px){ table, th, td { font-size:13px; } }
  
.progress-container {
  position: relative;
  width: 75%;
  margin: 6px 0;
  background-color: #ddd;
  border-radius: 10px;
  height: 12px;
}

.progress-bar {
  height: 100%;
  border-radius: 10px;
  transition: width 0.8s ease, background-color 0.8s ease;
}

/* üëá The %100 limit line */
.progress-limit-line {
  position: absolute;
  left: 100%;                  /* places the line at the end of the ‚Äúlimit‚Äù width */
  top: 0;
  bottom: 0;
  width: 2px;                  /* thin line */
  background-color: #444;      /* dark gray line (can change to red or orange) */
  transform: translateX(-1px); /* centers the line visually */
}
</style>
</head>
<body>
<div class="sheet">
  <h1>HOME ‚Äî Energy Consumption Dashboard</h1>
  <div class="meta">
    
  </div>

  <!-- BASKENTGAZ -->
  <div class="section-title">BA≈ûKENTGAZ<div class="pill">Auto-updates: <span id="nowText"></span></div></div>
  <table id="gasTable">
    <thead>
      <tr>
        <th>Label</th>
        <th>First Reading Date</th>
        <th>First Reading</th>
        <th>Last Reading Date</th>
        <th>Last Reading</th>
        <th>Days Passed</th>
        <th>Consumption (m¬≥)</th>
        <th>Daily AVG (m¬≥/d)</th>
        <th>Estimated Monthly Cons. (m¬≥)</th>
        <th>Unit Price (m3/TL)</th>
        <th>Actual Cost (TL)</th>
        <th>Estimated Monthly Cost (TL)</th>
      
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="small">Period</td>
        <td id="gas_firstDateCell">--</td>
        <td id="gas_firstReadingCell" class="num">--</td>
        <td id="gas_nowDateCell">--</td>
        <td id="gas_lastReadingCell" class="num">--</td>
        <td id="gas_daysCell" class="num">--</td>
        <td id="gas_consCell" class="num">--</td>
        <td id="gas_dailyAvgCell" class="num">--</td>
        <td id="gas_estMonthlyCell" class="num">--</td>
        <td id="gas_unitPriceCell" class="num">--</td>
        <td id="gas_periodTotalCostCell" class="num">--</td>
        <td id="gas_estMonthlyCostCell" class="num">--</td>
       
      </tr>
      <tr>
        <td class="small">Note</td> 
        <td colspan="11" id="gas_limitNote" class="small">Limit check will appear here.</td>
      </tr>
             
        <tr><td colspan="10">
  <div class="progress-container">
    <div id="gas_progressBar" class="progress-bar"></div>
  </div>
</td></tr>
        
          
    </tbody>
  </table>

  <!-- MONTHLY ANALYSIS -->
  <div class="section-title">MONTHLY GAS ANALYSIS for past 5 years - Average consumptions</div>
  <table id="monthlyAnalysis">

    <tbody>
      <!-- Embedded monthly averages from your HOME sheet -->
      <tr style="background-color:#eaf3ff;"><th>Month of year</th><td>Ocak</td><td>≈ûubat</td><td>Mart</td><td>Nisan</td><td>Mayƒ±s</td><td>Haziran</td><td>Temmuz</td>
        <td>Aƒüustos</td><td>Eyl√ºl</td><td>Ekim</td><td>Kasƒ±m</td><td>Aralƒ±k</td></tr>
      
      <tr><th>Daily AVG (m¬≥/d)</th><td>3.23</td><td>3.91</td><td>2.97</td><td>1.92</td><td>0.89</td><td>0.77</td><td>0.66</td>
        <td>0.56</td><td>0.72</td><td>1.37</td><td>2.75</td><td>3.35</td></tr>
      
      <tr><th>Monthly AVG (m¬≥/mo)</th><td>100.21</td><td>113.46</td><td>91.99</td><td>57.47</td><td>27.74</td><td>23.07</td><td>20.61</td>
        <td>17.50</td><td>21.52</td><td>42.61</td><td>82.62</td><td>103.78</td></tr>  
    </tbody>
  </table>

    <!-- ENERJISA -->
  <div class="section-title">ENERJISA</div>
  <table id="elecTable">
    <thead>
      <tr>
        <th>Label</th>
        <th>First Reading Date</th>
        <th>First Reading</th>
        <th>Last Reading Date</th>
        <th>Last Reading</th>
        <th>Days Passed</th>
        <th>Consumption (m¬≥)</th>
        <th>Daily AVG (m¬≥/d)</th>
        <th>Estimated Monthly Cons. (m¬≥)</th>
        <th>Unit Price (m3/TL)</th>
        <th>Actual Cost (TL)</th>
        <th>Estimated Monthly Cost (TL)</th>
      
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="small">Period</td>
        <td id="elec_firstDateCell">--</td>
        <td id="elec_firstReadingCell" class="num">--</td>
        <td id="elec_nowDateCell">--</td>
        <td id="elec_lastReadingCell" class="num">--</td>
        <td id="elec_daysCell" class="num">--</td>
        <td id="elec_consCell" class="num">--</td>
        <td id="elec_dailyAvgCell" class="num">--</td>
        <td id="elec_estMonthlyCell" class="num">--</td>
        <td id="elec_unitPriceCell" class="num">--</td>
        <td id="elec_periodTotalCostCell" class="num">--</td>
        <td id="elec_estMonthlyCostCell" class="num">--</td>
        
      </tr>
      <tr>
        <td class="small">Note</td>
        <td colspan="11" id="elec_limitNote" class="small">Limit check will appear here.</td>
      </tr>
    <tr><td colspan="10">
  <div class="progress-container">
    <div id="elec_progressBar" class="progress-bar"></div>
  </div>
</td></tr>  
      
    </tbody>
  </table>

    <!-- ASKI -->
  <div class="section-title">ASKI</div>
  <table id="waterTable">
    <thead>
      <tr>
        <th>Label</th>
        <th>First Reading Date</th>
        <th>First Reading</th>
        <th>Last Reading Date</th>
        <th>Last Reading</th>
        <th>Days Passed</th>
        <th>Consumption (m¬≥)</th>
        <th>Daily AVG (m¬≥/d)</th>
        <th>Estimated Monthly Cons. (m¬≥)</th>
        <th>Unit Price (m3/TL)</th>
        <th>Actual Cost (TL)</th>
        <th>Estimated Monthly Cost (TL)</th>
       
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="small">Period</td>
        <td id="water_firstDateCell">--</td>
        <td id="water_firstReadingCell" class="num">--</td>
        <td id="water_nowDateCell">--</td>
        <td id="water_lastReadingCell" class="num">--</td>
        <td id="water_daysCell" class="num">--</td>
        <td id="water_consCell" class="num">--</td>
        <td id="water_dailyAvgCell" class="num">--</td>
        <td id="water_estMonthlyCell" class="num">--</td>
        <td id="water_unitPriceCell" class="num">--</td>
        <td id="water_periodTotalCostCell" class="num">--</td>
        <td id="water_estMonthlyCostCell" class="num">--</td>  
      </tr>
      <tr>
        <td class="small">Note</td>
        <td colspan="11" id="limitNote" class="small">Limit check will appear here.</td>
      </tr>
    </tbody>
  </table>

  <div class="footnote">
    <strong>How to publish updates:</strong> Edit the values in the script section of this file (see variables near top of the script) and commit/push to your GitHub Pages repo. The page will then recalculate for viewers using their current time (so derived daily averages and estimates change as time passes).
  </div>
</div>

<script>
/* ======= CONFIGURATION ======= */

// GAS
const gasConfig = {
  prefix: "gas",
  firstDateStr: "2025-10-06T11:19:57",
  firstReading: 6982,
  lastReading: 7038.41,
  unitPrice: 11.50,
  limitType: "gas"
};

// ELECTRICITY
const elecConfig = {
  prefix: "elec",
  firstDateStr: "2025-10-01T09:00:00",
  firstReading: 1798.723,
  lastReading: 1894.92,
  unitPrice: 2.60,
  dailyLimit: 5.65,    // 4.52 * 1.25
  monthlyLimit: 169.5, // 5.65 * 30
  limitType: "fixed"
};

// WATER
const waterConfig = {
  prefix: "water",
  firstDateStr: "2025-10-08T08:20:00",
  firstReading: 284.2,
  lastReading: 288.9,
  unitPrice: 25.00,
  dailyLimit: 0.46,   // 0.37 * 1.25
  monthlyLimit: 13.8, // 0.46 * 30
  limitType: "fixed"
};

/* ======= HELPERS ======= */
const fmt = (v, dp=2) =>
  isNaN(v) ? "--" :
  Number(v).toLocaleString(undefined, { minimumFractionDigits: dp, maximumFractionDigits: dp });

const monthNamesTr = ["Ocak","≈ûubat","Mart","Nisan","Mayƒ±s","Haziran","Temmuz","Aƒüustos","Eyl√ºl","Ekim","Kasƒ±m","Aralƒ±k"];

/* --- Reads MONTHLY GAS ANALYSIS TABLE --- */
function readMonthlyAnalysis() {
  const table = document.getElementById('monthlyAnalysis');
  const rows = table?.querySelectorAll('tbody tr');
  if (!rows || rows.length < 3) return {};

  const months = rows[0].querySelectorAll('td');
  const dailyAvgs = rows[1].querySelectorAll('td');
  const monthlyAvgs = rows[2].querySelectorAll('td');

  const data = {};
  for (let i = 0; i < months.length; i++) {
    const name = months[i].textContent.trim();
    const daily = parseFloat(dailyAvgs[i]?.textContent) || 0;
    const monthly = parseFloat(monthlyAvgs[i]?.textContent) || 0;
    data[name] = { daily, monthly };
  }
  return data;
}

/* ======= MAIN FUNCTION ======= */
function updateConsumption(cfg, monthlyData={}) {
  const now = new Date();
  const firstDate = new Date(cfg.firstDateStr);
  let daysPassed = (now - firstDate) / (1000 * 60 * 60 * 24);
  if (daysPassed <= 0.00001) daysPassed = 0.00001;

  const consumption = cfg.lastReading - cfg.firstReading;
  const dailyAvg = consumption / daysPassed;
  const estMonthly = dailyAvg * 30;
  const periodTotalCost = consumption * cfg.unitPrice;
  const estMonthlyCost = estMonthly * cfg.unitPrice;

  // Update table values
  document.getElementById(`${cfg.prefix}_firstDateCell`).textContent = firstDate.toLocaleString();
  document.getElementById(`${cfg.prefix}_firstReadingCell`).textContent = fmt(cfg.firstReading, 2);
  document.getElementById(`${cfg.prefix}_nowDateCell`).textContent = now.toLocaleString();
  document.getElementById(`${cfg.prefix}_lastReadingCell`).textContent = fmt(cfg.lastReading, 2);
  document.getElementById(`${cfg.prefix}_daysCell`).textContent = fmt(daysPassed, 2);
  document.getElementById(`${cfg.prefix}_consCell`).textContent = fmt(consumption, 3);
  document.getElementById(`${cfg.prefix}_dailyAvgCell`).textContent = fmt(dailyAvg, 3);
  document.getElementById(`${cfg.prefix}_estMonthlyCell`).textContent = fmt(estMonthly, 3);
  document.getElementById(`${cfg.prefix}_unitPriceCell`).textContent = fmt(cfg.unitPrice, 2);
  document.getElementById(`${cfg.prefix}_estMonthlyCostCell`).textContent = fmt(estMonthlyCost, 2);
  document.getElementById(`${cfg.prefix}_periodTotalCostCell`).textContent = fmt(periodTotalCost, 2);

  // ===== LIMIT CHECK =====
  const noteEl = document.getElementById(`${cfg.prefix}_limitNote`);
  const barEl = document.getElementById(`${cfg.prefix}_progressBar`);

  let dailyLimit = 0, monthlyLimit = 0;

  if (cfg.limitType === "gas") {
    const currentMonth = monthNamesTr[now.getMonth()];
    const avgData = monthlyData[currentMonth];
    if (avgData) {
      dailyLimit = avgData.daily * 1.25;
      monthlyLimit = avgData.monthly * 1.25;
    }
  } else {
    dailyLimit = cfg.dailyLimit;
    monthlyLimit = cfg.monthlyLimit;
  }

  let percent = (dailyAvg / dailyLimit) * 100;
  if (percent > 150) percent = 150;

  // Progress bar color
  let barColor = "green";
  if (percent > 90 && percent <= 110) barColor = "orange";
  else if (percent > 110) barColor = "red";

  barEl.style.width = `${percent}%`;
  barEl.style.backgroundColor = barColor;

  // Overusage cost
  let msg = "";
  if (dailyAvg > dailyLimit) {
    const overUsage = estMonthly - monthlyLimit;
    const extraCost = overUsage * cfg.unitPrice;
    msg = `Estimated over limit by ${fmt(overUsage,2)} units ‚Üí Extra cost ‚âà ${fmt(extraCost,2)} ‚Ç∫`;
  } else {
    msg = `Within limit. Estimated monthly usage ${fmt(estMonthly,2)} / limit ${fmt(monthlyLimit,2)}.`;
  }

  noteEl.innerHTML = `<span style="font-weight:600; color:${barColor};">${msg}</span>`;
}

/* ======= UPDATE LOOP ======= */
function recalcAndRender() {
  const now = new Date();
  document.getElementById('nowText').textContent = now.toLocaleString();

  const monthlyData = readMonthlyAnalysis();

  updateConsumption(gasConfig, monthlyData);
  updateConsumption(elecConfig);
  updateConsumption(waterConfig);
  
  // inside updateConsumption or similar function
const container = document.createElement("div");
container.className = "progress-container";

const bar = document.createElement("div");
bar.className = "progress-bar";
bar.style.width = `${Math.min(percent, 120)}%`;  // actual usage bar
bar.style.backgroundColor = percent > 100 ? "#ff6b6b" : "#5cb85c";

const limitLine = document.createElement("div");
limitLine.className = "progress-limit-line";     // üëà adds the marker

container.appendChild(bar);
container.appendChild(limitLine);
cell.appendChild(container);
  
  
  
}

// Initial run + refresh every 30s
recalcAndRender();
setInterval(recalcAndRender, 30 * 1000);
</script>
</body>
</html>
